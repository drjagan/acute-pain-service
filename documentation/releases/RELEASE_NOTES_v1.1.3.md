# ðŸ› Installation Fixes & Database Tools - v1.1.3

Critical fixes for installation wizard and new SQL export file for easy database setup.

## âš¡ Quick Installation

### Option 1: PhpMyAdmin Import (Fastest - 2 minutes)

```bash
# 1. Download release
wget https://github.com/drjagan/acute-pain-service/archive/refs/tags/v1.1.3.tar.gz
tar -xzf v1.1.3.tar.gz
cd acute-pain-service-1.1.3

# 2. In PhpMyAdmin:
#    - Create database: aps_database
#    - Import: database/aps_database_complete.sql
#    - Update config/config.php with credentials

# 3. Login with admin/admin123
```

### Option 2: Installation Wizard (With debugging)

```bash
wget https://github.com/drjagan/acute-pain-service/archive/refs/tags/v1.1.3.tar.gz
tar -xzf v1.1.3.tar.gz
cd acute-pain-service-1.1.3

# Navigate to: http://your-domain/install/
# If issues occur, check: logs/install.log
```

### Option 3: Automated LAMP Installation

```bash
wget https://github.com/drjagan/acute-pain-service/archive/refs/tags/v1.1.3.tar.gz
tar -xzf v1.1.3.tar.gz
cd acute-pain-service-1.1.3
sudo chmod +x deployment/scripts/install.sh
sudo ./deployment/scripts/install.sh
```

---

## ðŸ†• What's New in v1.1.3

### SQL Export File for PhpMyAdmin

**NEW FILE:** `database/aps_database_complete.sql`

- **Complete database schema** - All 16 tables with proper structure
- **Sample data included** - 4 test users (admin, dr.sharma, dr.patel, nurse.kumar)
- **Lookup data** - Pre-populated dropdown options
- **Ready for import** - Direct PhpMyAdmin import support
- **Fast setup** - 2-3 minutes from download to working application

**Import in PhpMyAdmin:**
1. Create database: `aps_database`
2. Select database â†’ Import tab
3. Choose file: `database/aps_database_complete.sql`
4. Click "Go"
5. Done!

### Installation Wizard Debugging

**Problem:** Installation wizard would stall with no error messages  
**Solution:** Comprehensive error logging and debug displays

**New Features:**
- âœ… **Error logging** - All steps logged to `logs/install.log`
- âœ… **Debug panel** - Visual error information when failures occur
- âœ… **Stack traces** - Full exception details in log file
- âœ… **Path validation** - Checks if migration/seed directories exist
- âœ… **Connection timeout** - 5-10 second timeout for database connections
- âœ… **Statement counting** - Shows how many SQL statements executed
- âœ… **Better error messages** - Includes error codes and helpful hints

**Check logs:**
```bash
# View installation log
tail -f logs/install.log

# Example output:
[APS Install] Installation wizard started - Step: 3
[APS Install] Connecting to database: aps_database@localhost
[APS Install] Database connection established
[APS Install] Running migration: 001_create_users_table.sql
[APS Install] âœ“ 001_create_users_table.sql completed (1 statements)
```

### No More Hardcoded Credentials

**Problem:** Database password hardcoded in `config/database.php`  
**Solution:** Dynamic credential loading

**Now supports (in priority order):**
1. **config/config.php** - Generated by installation wizard
2. **Environment variables** - `DB_HOST`, `DB_USER`, `DB_PASS`, etc.
3. **CLI arguments** - For `install/database-setup.php`
4. **Default values** - localhost, root, empty password

**Benefits:**
- âœ… No passwords committed to git
- âœ… Different credentials per environment (dev/staging/prod)
- âœ… Docker and CI/CD compatible
- âœ… Follows security best practices

**Example usage:**
```bash
# Using environment variables
export DB_HOST=localhost
export DB_USER=aps_user
export DB_PASS=secret_password
php install/database-setup.php

# Using CLI arguments
php install/database-setup.php localhost 3306 aps_database aps_user password

# Using config.php (created by wizard)
php install/database-setup.php
```

---

## ðŸ“¦ What's Included

### New Files (3)
1. **`database/aps_database_complete.sql`** (28 KB)
   - Complete SQL export ready for PhpMyAdmin
   - All 16 tables + sample data + lookup data
   
2. **`database/README.md`** (500+ lines)
   - Complete import guide with screenshots
   - Troubleshooting common issues
   - Multiple installation methods
   - Security best practices
   
3. **`INSTALLATION_FIXES.md`** (400+ lines)
   - Comprehensive fix documentation
   - Debugging guide
   - What was changed and why

### Modified Files (5)
1. **`config/database.php`** - Dynamic credential loading
2. **`install/functions.php`** - Extensive logging added
3. **`install/index.php`** - Error reporting enabled
4. **`install/steps/step3-tables.php`** - Debug info display
5. **`install/database-setup.php`** - CLI args support

### Database Tables Created (16)
1. users - User authentication and RBAC
2. patients - Patient demographic data
3. catheters - Catheter insertion records
4. drug_regimes - Medication administration
5. functional_outcomes - Patient assessments
6. catheter_removals - Removal records
7. alerts - System alerts
8. audit_logs - Audit trail
9. patient_physicians - Patient assignments
10. notifications - User notifications
11. smtp_settings - Email configuration
12. lookup_catheter_types - Catheter types
13. lookup_comorbidities - Comorbidity options
14. lookup_surgeries - Surgery types
15. lookup_drug_names - Drug names
16. lookup_complications - Complication types

---

## ðŸ”§ Installation Methods

### Method 1: PhpMyAdmin Import (RECOMMENDED)

**Fastest method - 2-3 minutes total**

1. Download and extract release
2. In PhpMyAdmin:
   - Create database: `aps_database` (utf8mb4_unicode_ci)
   - Select database
   - Import tab â†’ Choose `database/aps_database_complete.sql`
   - Click "Go"
3. Update `config/config.php` with your database credentials
4. Navigate to your application URL
5. Login with: `admin` / `admin123`

**Perfect for:**
- Quick setup
- Shared hosting
- Users familiar with PhpMyAdmin
- When you need it working fast

### Method 2: Installation Wizard

**Step-by-step guided installation**

1. Download and extract release
2. Navigate to: `http://your-domain/install/`
3. Follow wizard steps:
   - Step 1: System requirements check
   - Step 2: Database configuration
   - Step 3: Create tables (with debugging!)
   - Step 4: Create admin user
   - Step 5: Complete
4. If issues occur:
   - Check `logs/install.log` for detailed errors
   - Debug information displayed on screen
   - See `database/README.md` for troubleshooting

**Perfect for:**
- Custom admin credentials
- Learning the installation process
- When you need control over each step

### Method 3: Automated LAMP Installation

**Complete server setup - 15-20 minutes**

1. Download and extract release
2. Make script executable: `chmod +x deployment/scripts/install.sh`
3. Run: `sudo ./deployment/scripts/install.sh`
4. Script installs:
   - Apache 2.4
   - MySQL 8.0
   - PHP 8.3 with extensions
   - Creates database
   - Configures virtual host
   - Sets permissions
   - Creates admin user

**Perfect for:**
- Fresh Ubuntu 20.04/22.04 server
- Production deployments
- Automated setups
- VPS or cloud servers

---

## ðŸ› Troubleshooting

### Installation Wizard Stalls

**Solution:**
```bash
# Check the log file
cat logs/install.log

# Look for errors
grep "ERROR" logs/install.log
grep "FATAL" logs/install.log

# Common fixes:
chmod 777 logs/
chmod 777 config/
service mysql start
```

### PhpMyAdmin Import Fails

**Common issues:**
1. **Access denied** - Grant privileges: `GRANT ALL ON aps_database.* TO 'user'@'localhost';`
2. **Table exists** - Drop database first: `DROP DATABASE aps_database;` (âš ï¸ deletes data!)
3. **Timeout** - Increase in php.ini: `max_execution_time = 300`

### Hardcoded Password Error

If you see the old hardcoded password error:
1. Update to v1.1.3
2. Set credentials in `config/config.php` or environment variables
3. Or use the installation wizard to generate config

---

## ðŸ”’ Security Notes

### Change Default Passwords

**IMPORTANT:** All test users have password `admin123`. Change immediately!

**Test Users:**
- `admin` / `admin123` - System Administrator
- `dr.sharma` / `admin123` - Attending Physician
- `dr.patel` / `admin123` - Resident
- `nurse.kumar` / `admin123` - Nurse

**Change passwords:**
1. Login as admin
2. Go to Users â†’ Select user â†’ Edit
3. Change password
4. Or use SQL:
   ```sql
   UPDATE users SET password_hash = '$2y$12$YOUR_NEW_HASH' WHERE username = 'admin';
   ```

### Create Production Database User

Don't use `root` in production:

```sql
CREATE USER 'aps_user'@'localhost' IDENTIFIED BY 'strong_random_password';
GRANT ALL PRIVILEGES ON aps_database.* TO 'aps_user'@'localhost';
FLUSH PRIVILEGES;
```

Update `config/config.php`:
```php
define('DB_USER', 'aps_user');
define('DB_PASS', 'strong_random_password');
```

---

## ðŸ“š Documentation

After installation, see:
- **`database/README.md`** - Complete import and troubleshooting guide
- **`INSTALLATION_FIXES.md`** - What was fixed and why
- **`DEPLOY.md`** - Production deployment guide
- **`LAMP_INSTALL.md`** - Server setup guide
- **`CHANGELOG.md`** - Full version history

---

## ðŸ”— Links

- **GitHub Repository:** https://github.com/drjagan/acute-pain-service
- **Download v1.1.3:** https://github.com/drjagan/acute-pain-service/archive/refs/tags/v1.1.3.tar.gz
- **Report Issues:** https://github.com/drjagan/acute-pain-service/issues
- **Previous Release (v1.1.2):** https://github.com/drjagan/acute-pain-service/releases/tag/v1.1.2

---

## âœ¨ Features (from v1.1.2)

- Complete patient lifecycle management
- 21 types of epidural and nerve catheters support
- Drug regime tracking with VNRS scores
- Functional outcomes assessment
- Individual and consolidated reports
- Role-based access control (Admin, Attending, Resident, Nurse)
- Real-time notifications
- Mobile responsive design
- Zero framework dependencies (pure PHP MVC)

---

## ðŸ“Š System Requirements

- **OS:** Ubuntu 20.04/22.04 LTS (other Linux distributions supported)
- **PHP:** 8.1+ (8.3 recommended)
- **MySQL:** 8.0+ or MariaDB 10.5+
- **Apache:** 2.4+
- **RAM:** Minimum 2GB (4GB recommended)
- **Disk:** 10GB available space

---

## ðŸŽ¯ Upgrade from v1.1.2

If you're already running v1.1.2:

```bash
# Backup your database first!
mysqldump -u root -p aps_database > backup_before_upgrade.sql

# Download v1.1.3
wget https://github.com/drjagan/acute-pain-service/archive/refs/tags/v1.1.3.tar.gz
tar -xzf v1.1.3.tar.gz

# Copy your config
cp acute-pain-service-1.1.2/config/config.php acute-pain-service-1.1.3/config/

# Replace old installation
mv acute-pain-service-1.1.2 acute-pain-service-1.1.2-backup
mv acute-pain-service-1.1.3 acute-pain-service

# No database changes needed - v1.1.3 is compatible with v1.1.2 database
```

---

## ðŸ†˜ Support

For issues:
1. Check `logs/install.log` for installation errors
2. See `database/README.md` for PhpMyAdmin troubleshooting
3. Review `INSTALLATION_FIXES.md` for common solutions
4. Create an issue: https://github.com/drjagan/acute-pain-service/issues

---

**Full Changelog:** https://github.com/drjagan/acute-pain-service/compare/v1.1.2...v1.1.3

**Installation improvements, database tools, and security fixes**
